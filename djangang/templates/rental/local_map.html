{% extends "base.html" %}
{% load static %}

{% block title %}Map{% endblock %}

{% block head %}
<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
{%  endblock %}

{% block content %}

<div id='map' style='width: 400px; height: 300px;'></div>

	<style>
		  body {
		margin: 0;
		padding: 0;
	  }

	  #map {
		top: 0;
		bottom: 0;
		width: 100%;
	  }
	  .marker {
      background-image: url({% static "marker.png"  %});
	  background-size: cover;
	  width: 50px;
	  height: 50px;
	  border-radius: 50%;
	  cursor: pointer;
	  }
        .mapboxgl-popup {
        max-width: 200px;
        }

        .mapboxgl-popup-content {
        text-align: center;
        font-family: 'Open Sans', sans-serif;
        }
	</style>

<script>

const geojson = {{ geojson }}

  mapboxgl.accessToken = 'pk.eyJ1Ijoic2FzdDI4ODMiLCJhIjoiY2wwZWJuNWk0MGhrMDNkcXRpYmN5cmhsbiJ9.WGzYt8gxP35lsgRxnzTopQ';
  var map = new mapboxgl.Map({
	container: 'map',
	style: 'mapbox://styles/mapbox/streets-v11',
	center: [-74.5, 40],
	zoom: 3
  });


for (const feature of geojson.features) {
  // create a HTML element for each feature
  const el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add to the map
  new mapboxgl.Marker(el)
      .setLngLat(feature.geometry.coordinates)
      .setPopup(
      new mapboxgl.Popup({ offset: 25 }) // add popups
      .setHTML(
        `<h3>${feature.properties.title}</h3><p>${feature.properties.description}</p>`
      )
      )
      .addTo(map);
}

</script>


{% endblock %}